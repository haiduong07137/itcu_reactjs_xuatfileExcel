{"ast":null,"code":"import _classCallCheck from \"D:\\\\gocBaitap\\\\ETan\\\\ICTUedu\\\\Client2\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"D:\\\\gocBaitap\\\\ETan\\\\ICTUedu\\\\Client2\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport axios from \"axios\";\nimport localStorageService from \"./localStorageService\";\nimport ConstantList from \"../appConfig\";\nimport UserService from \"../services/UserService\";\nimport history from \"history.js\";\nvar config = {\n  headers: {\n    'Content-Type': 'application/x-www-form-urlencoded',\n    'Authorization': 'Basic Y29yZV9jbGllbnQ6c2VjcmV0'\n  }\n};\n\nvar JwtAuthService = /*#__PURE__*/function () {\n  function JwtAuthService() {\n    var _this = this;\n\n    _classCallCheck(this, JwtAuthService);\n\n    this.user = {\n      userId: \"1\",\n      role: 'ADMIN',\n      displayName: \"Watson Joyce\",\n      email: \"watsonjoyce@gmail.com\",\n      photoURL: ConstantList.ROOT_PATH + \"assets/images/avatar.jpg\",\n      age: 25,\n      token: \"faslkhfh423oiu4h4kj432rkj23h432u49ufjaklj423h4jkhkjh\"\n    };\n\n    this.loginWithUserNameAndPassword = function (username, password) {\n      var requestBody = 'client_id=core_client&grant_type=password&client_secret=secret';\n      requestBody = requestBody + '&username=' + username + '&password=' + password;\n      return axios.post(ConstantList.API_ENPOINT + '/oauth/token', requestBody, config).then(function (response) {\n        _this.setSession(response.data.access_token);\n\n        axios.get(ConstantList.API_ENPOINT + \"/api/users/getCurrentUser\").then(function (_ref) {\n          var data = _ref.data;\n\n          _this.setLoginUser(response.data, data);\n        });\n      });\n    };\n\n    this.loginWithEmailAndPassword = function (email, password) {\n      return new Promise(function (resolve, reject) {\n        setTimeout(function () {\n          resolve(_this.user);\n        }, 1000);\n      }).then(function (data) {\n        //console.log(data);\n        _this.setUser(data);\n\n        _this.setSession(data.token);\n\n        return data;\n      });\n    };\n\n    this.loginWithToken = function () {\n      return new Promise(function (resolve, reject) {\n        setTimeout(function () {\n          resolve(_this.user);\n        }, 100);\n      }).then(function (data) {\n        _this.setSession(data.token);\n\n        _this.setUser(data);\n\n        return data;\n      });\n    };\n\n    this.logout = function () {\n      if (ConstantList.AUTH_MODE == \"Keycloak\") {\n        UserService.doLogout();\n\n        _this.setSession(null);\n\n        _this.removeUser();\n\n        history.push(ConstantList.HOME_PAGE);\n      } else {\n        _this.setSession(null);\n\n        _this.removeUser();\n\n        history.push(ConstantList.LOGIN_PAGE);\n      }\n    };\n\n    this.setLoginUser = function (data, userData) {\n      var user = {};\n      user.token = data.access_token;\n      user.role = userData.roles[0].name;\n      user.displayName = userData.displayName;\n      user.photoURL = ConstantList.ROOT_PATH + \"assets/images/avatar.jpg\";\n      _this.user = user;\n      localStorageService.setItem(\"auth_user\", user);\n      return user;\n    };\n\n    this.setLoginToken = function (data) {\n      var user = {};\n      user.token = data;\n      user.role = \"ADMIN\";\n      user.age = 25;\n      user.displayName = \"Watson Joyce\";\n      user.photoURL = ConstantList.ROOT_PATH + \"assets/images/avatar.jpg\";\n      _this.user = user;\n      localStorageService.setItem(\"auth_user\", user);\n      return user;\n    };\n\n    this.setUser = function (user) {\n      localStorageService.setItem(\"auth_user\", user);\n    };\n\n    this.removeUser = function () {\n      localStorageService.removeItem(\"auth_user\");\n    };\n  }\n\n  _createClass(JwtAuthService, [{\n    key: \"setSession\",\n    value: function setSession(token) {\n      if (token) {\n        localStorageService.setItem(\"jwt_token\", token);\n        axios.defaults.headers.common[\"Authorization\"] = \"Bearer \" + token;\n      } else {\n        localStorage.removeItem(\"jwt_token\");\n        delete axios.defaults.headers.common[\"Authorization\"];\n      }\n    }\n  }]);\n\n  return JwtAuthService;\n}();\n\nexport default new JwtAuthService();","map":{"version":3,"sources":["D:/gocBaitap/ETan/ICTUedu/Client2/src/app/services/jwtAuthService.js"],"names":["axios","localStorageService","ConstantList","UserService","history","config","headers","JwtAuthService","user","userId","role","displayName","email","photoURL","ROOT_PATH","age","token","loginWithUserNameAndPassword","username","password","requestBody","post","API_ENPOINT","then","response","setSession","data","access_token","get","setLoginUser","loginWithEmailAndPassword","Promise","resolve","reject","setTimeout","setUser","loginWithToken","logout","AUTH_MODE","doLogout","removeUser","push","HOME_PAGE","LOGIN_PAGE","userData","roles","name","setItem","setLoginToken","removeItem","defaults","common","localStorage"],"mappings":"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","sourcesContent":["import axios from \"axios\";\nimport localStorageService from \"./localStorageService\";\nimport ConstantList from \"../appConfig\";\nimport UserService from \"../services/UserService\"; \nimport history from \"history.js\";\nconst config = {\n  headers: {\n    'Content-Type': 'application/x-www-form-urlencoded',\n    'Authorization': 'Basic Y29yZV9jbGllbnQ6c2VjcmV0'\n  }\n}\nclass JwtAuthService {\n\n\n  user = {\n    userId: \"1\",\n    role: 'ADMIN',\n    displayName: \"Watson Joyce\",\n    email: \"watsonjoyce@gmail.com\",\n    photoURL: ConstantList.ROOT_PATH + \"assets/images/avatar.jpg\",\n    age: 25,\n    token: \"faslkhfh423oiu4h4kj432rkj23h432u49ufjaklj423h4jkhkjh\"\n  }\n  loginWithUserNameAndPassword = (username, password) => {\n    let requestBody = 'client_id=core_client&grant_type=password&client_secret=secret';\n    requestBody = requestBody + '&username=' + username + '&password=' + password;\n    return axios.post(ConstantList.API_ENPOINT + '/oauth/token', requestBody, config).then(response => {\n      this.setSession(response.data.access_token);\n      axios.get(ConstantList.API_ENPOINT + \"/api/users/getCurrentUser\").then(({ data }) => {\n        this.setLoginUser(response.data,data); \n      });\n     \n    });\n  };\n\n  loginWithEmailAndPassword = (email, password) => {\n    return new Promise((resolve, reject) => {\n      setTimeout(() => {\n        resolve(this.user);\n      }, 1000);\n    }).then(data => {\n      //console.log(data);\n      this.setUser(data);\n      this.setSession(data.token);\n      return data;\n    });\n  };\n\n  loginWithToken = () => {\n    return new Promise((resolve, reject) => {\n      setTimeout(() => {\n        resolve(this.user);\n      }, 100);\n    }).then(data => {\n      this.setSession(data.token);\n      this.setUser(data);\n      return data;\n    });\n  };\n\n\n\n  logout = () => {\n\n    if (ConstantList.AUTH_MODE == \"Keycloak\") {\n      UserService.doLogout();\n      this.setSession(null);\n      this.removeUser();\n      history.push(ConstantList.HOME_PAGE)\n    } else {\n      this.setSession(null);\n      this.removeUser();\n      history.push(ConstantList.LOGIN_PAGE)\n    }\n  }\n\n  setSession(token) {\n    if (token) {\n      localStorageService.setItem(\"jwt_token\", token);\n      axios.defaults.headers.common[\"Authorization\"] = \"Bearer \" + token;\n    } else {\n      localStorage.removeItem(\"jwt_token\");\n      delete axios.defaults.headers.common[\"Authorization\"];\n    }\n  };\n  setLoginUser = (data,userData) => {\n    let user = {};\n    user.token = data.access_token;\n    user.role = userData.roles[0].name;  \n    user.displayName = userData.displayName;\n    user.photoURL = ConstantList.ROOT_PATH + \"assets/images/avatar.jpg\";\n    this.user = user;\n    localStorageService.setItem(\"auth_user\", user);\n    return user;\n  }\n\n  setLoginToken = (data) => {\n    let user = {};\n    user.token = data;\n    user.role = \"ADMIN\";\n    user.age = 25;\n    user.displayName = \"Watson Joyce\";\n    user.photoURL = ConstantList.ROOT_PATH + \"assets/images/avatar.jpg\";\n    this.user = user;\n    localStorageService.setItem(\"auth_user\", user);\n    return user;\n  }\n\n  setUser = (user) => {\n    localStorageService.setItem(\"auth_user\", user);\n  }\n  removeUser = () => {\n    localStorageService.removeItem(\"auth_user\");\n  }\n}\n\nexport default new JwtAuthService();\n"]},"metadata":{},"sourceType":"module"}